!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("final-form-arrays"),require("final-form")):"function"==typeof define&&define.amd?define(["exports","final-form-arrays","final-form"],e):e((t=t||self)["@tinacms/core"]={},t.arrayMutators,t.finalForm)}(this,function(t,c,f){"use strict";c=c&&c.hasOwnProperty("default")?c.default:c;var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var l=function(){return(l=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function p(n,r){var i,o,s,t,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}var e=(r.prototype.subscribe=function(t){var e=this;return this.__subscribers.push(t),function(){return e.unsubscribe(t)}},r.prototype.unsubscribe=function(t){var e=this.__subscribers.indexOf(t);this.__subscribers.splice(e,1)},r.prototype.notifiySubscribers=function(){this.__subscribers.forEach(function(t){return t()})},r);function r(){this.__subscribers=[]}var i=(o.prototype.findOrCreateMap=function(t){return this.plugins[t]=this.plugins[t]||new h(t)},o.prototype.add=function(t){this.findOrCreateMap(t.__type).add(t)},o.prototype.remove=function(t){this.findOrCreateMap(t.__type).remove(t)},o.prototype.all=function(t){return this.findOrCreateMap(t).all()},o);function o(){this.plugins={}}var s,a,u,h=(n(s=y,a=u=e),void(s.prototype=null===a?Object.create(a):(b.prototype=a.prototype,new b)),y.prototype.add=function(t){var e=t;e.__type||(e.__type=this.__type),this.__plugins[e.name]=e,this.notifiySubscribers()},y.prototype.all=function(){var e=this;return Object.keys(this.__plugins).map(function(t){return e.__plugins[t]})},y.prototype.find=function(t){return this.__plugins[t]},y.prototype.remove=function(t){var e="string"==typeof t?t:t.name,n=this.__plugins[e];return delete this.__plugins[e],this.notifiySubscribers(),n},y);function b(){this.constructor=s}function y(t){var e=u.call(this)||this;return e.__type=t,e.__plugins={},e}var d=(_.prototype.registerApi=function(t,e){this.api[t]=e},Object.defineProperty(_.prototype,"forms",{get:function(){return this.plugins.findOrCreateMap("form")},enumerable:!0,configurable:!0}),_);function _(){this.api={},this.plugins=new i}var m=(v.prototype.updateFields=function(t){this.fields=t},Object.defineProperty(v.prototype,"values",{get:function(){return this.finalForm.getState().values},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"name",{get:function(){return this.id},enumerable:!0,configurable:!0}),v.prototype.updateValues=function(t){var e=this;this.finalForm.batch(function(){e.finalForm.getState().active?function i(o,t,s){var a=o.getState().active;Object.entries(t).forEach(function(t){var e=t[0],n=t[1],r=s?s+"."+e:e;"object"==typeof n?a.startsWith(r)?i(o,n,r):o.change(r,n):r!==a&&o.change(r,n)})}(e.finalForm,t):function(r,t){Object.entries(t).forEach(function(t){var e=t[0],n=t[1];r.change(e,n)})}(e.finalForm,t)})},v);function v(t){var n=this,e=t.id,r=t.label,i=t.fields,o=t.actions,s=t.reset,a=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}(t,["id","label","fields","actions","reset"]);this.subscribe=function(t,e){return n.finalForm.subscribe(t,e)},this.submit=function(){return n.finalForm.submit()};var u=a.initialValues||{};this.__type=a.__type||"form",this.id=e,this.label=r,this.fields=i,this.finalForm=f.createForm(l({},a,{initialValues:u,onSubmit:function(n,r,i){return function(o,s,a,u){return new(a=a||Promise)(function(t,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function r(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(n,r)}i((u=u.apply(o,s||[])).next())})}(this,void 0,void 0,function(){var e;return p(this,function(t){switch(t.label){case 0:return[4,a.onSubmit(n,r,i)];case 1:return e=t.sent(),r.initialize(n),[2,e]}})})},mutators:l({},c,a.mutators)})),this.meta=a.meta||{},this.reset=s,this.actions=o||[],this.initialValues=u,this.updateFields(this.fields)}t.CMS=d,t.Form=m,t.PluginManager=i,t.PluginType=h,t.Subscribable=e,Object.defineProperty(t,"__esModule",{value:!0})});
