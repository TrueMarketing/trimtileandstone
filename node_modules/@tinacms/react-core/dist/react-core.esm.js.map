{"version":3,"file":"react-core.esm.js","sources":["../src/use-cms.ts","../src/use-plugin.tsx","../src/use-form.ts","../src/use-subscribable.tsx","../src/use-watch-form-values.ts","../src/with-plugin.tsx"],"sourcesContent":["/**\n\nCopyright 2019 Forestry.io Inc\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n\n*/\n\nimport * as React from 'react'\nimport { CMS } from '@tinacms/core'\n\nexport const ERROR_MISSING_CMS = `useCMS could not find an instance of CMS`\n\nexport const CMSContext = React.createContext<CMS | null>(null)\n\nexport function useCMS(): CMS {\n  const cms = React.useContext(CMSContext)\n\n  if (!cms) {\n    throw new Error(ERROR_MISSING_CMS)\n  }\n\n  return cms\n}\n","/**\n\nCopyright 2019 Forestry.io Inc\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n\n*/\n\nimport * as React from 'react'\nimport { Plugin } from '@tinacms/core'\nimport { useCMS } from './use-cms'\n\n/**\n * A React Hook for adding Plugins to the CMS.\n *\n * @alias usePlugins\n */\nexport const usePlugin = usePlugins\n\n/**\n *\n * @alias usePlugin\n */\nexport function usePlugins(plugins?: Plugin | Plugin[]) {\n  const cms = useCMS()\n\n  let pluginArray: (Plugin | undefined)[]\n\n  if (Array.isArray(plugins)) {\n    pluginArray = plugins\n  } else {\n    pluginArray = [plugins]\n  }\n\n  React.useEffect(() => {\n    pluginArray.forEach(plugin => {\n      if (plugin) {\n        cms.plugins.add(plugin);\n      }\n    })\n\n    return () => {\n      pluginArray.forEach(plugin => {\n        if (plugin) {\n          cms.plugins.remove(plugin);\n        }\n      })\n    }\n  }, [cms.plugins, ...pluginArray])\n}\n","/**\n\nCopyright 2019 Forestry.io Inc\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n\n*/\n\nimport { FormOptions, Form, Field } from '@tinacms/forms'\nimport * as React from 'react'\nimport { usePlugins } from './use-plugin'\n\nexport interface WatchableFormValue {\n  values: any\n  label: FormOptions<any>['label']\n  fields: FormOptions<any>['fields']\n}\n\nexport function useLocalForm<FormShape = any>(\n  options: FormOptions<any>,\n  watch: Partial<WatchableFormValue> = {}\n): [FormShape, Form] {\n  const [values, form] = useForm<FormShape>(options, watch)\n\n  usePlugins(form)\n\n  return [values, form]\n}\n\n/**\n * @alias useLocalForm\n */\nexport const useCMSForm = useLocalForm\n\n/**\n * A hook that creates a form and updates it's watched properties.\n */\nexport function useForm<FormShape = any>(\n  { loadInitialValues, ...options }: FormOptions<any>,\n  watch: Partial<WatchableFormValue> = {}\n): [FormShape, Form] {\n  /**\n   * `initialValues` will be usually be undefined if `loadInitialValues` is used.\n   *\n   * If the form helper is using `watch.values`, which would contain\n   * the current state of the form, then we set that to the `initialValues`\n   * so the form is initialized with some state.\n   *\n   * This is beneficial for SSR and will hopefully not be noticeable\n   * when editing the site as the actual `initialValues` will be set\n   * behind the scenes.\n   */\n  options.initialValues = options.initialValues || watch.values\n\n  const [, setValues] = React.useState(options.initialValues)\n  const [form, setForm] = React.useState<Form>(() => {\n    return createForm(options, (form: any) => {\n      setValues(form.values)\n    })\n  })\n\n  React.useEffect(\n    function() {\n      if (form.id === options.id) return\n      setForm(\n        createForm(options, (form: any) => {\n          setValues(form.values)\n        })\n      )\n    },\n    [options.id]\n  )\n\n  React.useEffect(() => {\n    if (loadInitialValues) {\n      loadInitialValues().then((values: any) => {\n        form.updateInitialValues(values)\n      })\n    }\n  }, [form])\n\n  useUpdateFormFields(form, watch.fields)\n  useUpdateFormLabel(form, watch.label)\n  useUpdateFormValues(form, watch.values)\n\n  return [form ? form.values : options.initialValues, form]\n}\n\nfunction createForm(options: FormOptions<any>, handleChange: any): Form {\n  const form = new Form(options)\n  form.subscribe(handleChange, { values: true })\n  return form\n}\n\n/**\n * A React Hook that update's the `Form` if `fields` are changed.\n *\n * This hook is useful when dynamically creating fields, or updating\n * them via hot module replacement.\n */\nfunction useUpdateFormFields(form: Form, fields?: Field[]) {\n  React.useEffect(() => {\n    if (typeof fields === 'undefined') return\n    form.updateFields(fields)\n  }, [form, fields])\n}\n\n/**\n * A React Hook that update's the `Form` if the `label` is changed.\n *\n * This hook is useful when dynamically creating creating the label,\n * or updating it via hot module replacement.\n */\nfunction useUpdateFormLabel(form: Form, label?: string) {\n  React.useEffect(() => {\n    if (typeof label === 'undefined') return\n    form.label = label\n  }, [form, label])\n}\n\n/**\n * Updates the Form with new values.\n *\n * Only updates fields that are:\n *\n * 1. registered with the form\n * 2. not currently [active](https://final-form.org/docs/final-form/types/FieldState#active)\n *\n * This hook is useful when the form must be kept in sync with the data source.\n */\nfunction useUpdateFormValues(form: Form, values?: any) {\n  React.useEffect(() => {\n    if (typeof values === 'undefined') return\n    form.updateValues(values)\n  }, [form, values])\n}\n","/**\n\nCopyright 2019 Forestry.io Inc\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n\n*/\n\nimport * as React from 'react'\nimport { Subscribable } from '@tinacms/core'\n/**\n *\n * @param subscribable An object that can be subscribed to\n * @param cb (Optional) A callback to be executed when an event occurs.\n */\nexport function useSubscribable(subscribable: Subscribable, cb?: Function) {\n  const [, s] = React.useState(0)\n  React.useEffect(() => {\n    return subscribable.subscribe(() => {\n      s(x => x + 1)\n      if (cb) cb()\n    })\n  })\n}\n","/**\n\nCopyright 2019 Forestry.io Inc\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n\n*/\n\nimport { Form } from '@tinacms/forms'\nimport { FormSubscriber } from 'final-form'\nimport { useEffect } from 'react'\n\n/**\n * Subscribes to value updates from the form with the given callback.\n */\nexport function useWatchFormValues(\n  form: Form | undefined,\n  cb: FormSubscriber<any>\n) {\n  useEffect(() => {\n    if (!form) return\n\n    // `form.subscribe` sends the current state on-subscription.\n    // We want to ignore that first call.\n    let firstUpdate = true\n\n    return form.subscribe(\n      formState => {\n        if (firstUpdate) {\n          firstUpdate = false\n        } else {\n          cb(formState)\n        }\n      },\n      { values: true }\n    )\n  }, [cb, form])\n}\n","/**\n\nCopyright 2019 Forestry.io Inc\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n\n*/\n\nimport { Plugin } from '@tinacms/core'\nimport { usePlugin } from './use-plugin'\nimport * as React from 'react'\n\n/**\n * A Higher-Order-Component for adding Plugins to the CMS.\n *\n * @param Component A React Component\n * @param plugin Plugin\n * @alias withPlugin\n */\nexport function withPlugins(Component: any, plugins: Plugin | Plugin[]) {\n  return (props: any) => {\n    usePlugin(plugins)\n    return <Component {...props} />\n  }\n}\n\n/**\n * A Higher-Order-Component for adding Plugins to the CMS.\n *\n * @param Component A React Component\n * @param plugin Plugin\n * @alias withPlugins\n */\nexport const withPlugin = withPlugins\n"],"names":["ERROR_MISSING_CMS","CMSContext","React","useCMS","cms","Error","usePlugin","usePlugins","plugins","pluginArray","Array","isArray","forEach","plugin","add","remove","useLocalForm","options","watch","useForm","values","form","useCMSForm","loadInitialValues","initialValues","setValues","createForm","setForm","id","then","updateInitialValues","useUpdateFormFields","fields","useUpdateFormLabel","label","useUpdateFormValues","handleChange","Form","subscribe","updateFields","updateValues","useSubscribable","subscribable","cb","s","x","useWatchFormValues","useEffect","firstUpdate","formState","withPlugins","Component","props","withPlugin"],"mappings":"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"}