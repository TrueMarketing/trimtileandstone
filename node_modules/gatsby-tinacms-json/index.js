!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("tinacms"),require("react")):"function"==typeof define&&define.amd?define(["exports","tinacms","react"],t):t((e=e||self)["gatsby-tinacms-json"]={},e.tinacms,e.React)}(this,function(e,c,f){"use strict";var d=function(){return(d=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function i(n,r){var o,i,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&t[0]?i.return:t[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,t[1])).done)return a;switch(i=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],i=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function a(e,t){void 0===t&&(t={});var n=function(e){var t=f.useState(e),n=t[0],r=t[1];return f.useEffect(function(){r(e||n)},[e]),n}(e);if(!n||"production"===process.env.NODE_ENV)return[n,null];!function(e){if(void 0===e.fileRelativePath)throw new Error(h);if(void 0===e.rawJson)throw new Error(m)}(n);var o=c.useCMS(),r=t.label||n.fileRelativePath,i=n.fileRelativePath,a=f.useMemo(function(){return{jsonNode:n,rawJson:JSON.parse(n.rawJson)}},[n]),s=t.fields||function(e){return Object.keys(e).map(function(e){return{component:"text",name:"rawJson."+e}})}(a.rawJson);s.push({name:"jsonNode",component:null});var u=c.useForm(d({id:i,label:r,fields:s,loadInitialValues:function(){return o.api.git.show(i).then(function(e){var t=JSON.parse(e.content);return{jsonNode:n,rawJson:t}})},onSubmit:function(e){return o.api.git.onSubmit({files:[e.jsonNode.fileRelativePath],message:e.__commit_message||"Tina commit",name:e.__commit_name,email:e.__commit_email})},reset:function(){return o.api.git.reset({files:[i]})}},t),{values:a,label:r,fields:s})[1],l=f.useCallback(function(e){var t=e.values,n=t.rawJson,r=t.jsonNode;o.api.git.onChange({fileRelativePath:r.fileRelativePath,content:JSON.stringify(n,null,2)})},[]);return c.useWatchFormValues(u,l),[n,u]}var h="useJsonForm(jsonNode) Required attribute `fileRelativePath` was not found on the `jsonNode`.\n\n1. Check if the `gatsby-tinacms-json` was added to the `gatsby-config.js`.\n2. Check if the `fileRelativePath` attribute is included in the GraphQL query.\n\n  ",m="useJsonForm(jsonNode) Required attribute `rawJson` was not found on the `jsonNode`.\n\n1. Check if the `gatsby-tinacms-json` was added to the `gatsby-config.js`.\n2. Check if the `rawJson` attribute is included in the GraphQL query.\n";var t="createJsonButton must be given `filename(form): string`",n="createJsonButton must be given `fields: Field[]` with at least 1 item",r=(o.prototype.onSubmit=function(r,o){return function(i,a,s,u){return new(s=s||Promise)(function(e,t){function n(e){try{o(u.next(e))}catch(e){t(e)}}function r(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}o((u=u.apply(i,a||[])).next())})}(this,void 0,void 0,function(){var t,n;return i(this,function(e){switch(e.label){case 0:return[4,this.filename(r)];case 1:return t=e.sent(),[4,this.data(r)];case 2:return n=e.sent(),o.api.git.onChange({fileRelativePath:t,content:JSON.stringify(n,null,2)}),[2]}})})},o);function o(e){if(this.__type="content-creator",!e.filename)throw console.error(t),new Error(t);if(!e.fields||0===e.fields.length)throw console.error(n),new Error(n);this.name=e.label,this.fields=e.fields,this.filename=e.filename,this.data=e.data||function(){return{}}}e.ERROR_MISSING_RAW_JSON=m,e.ERROR_MISSING_REMARK_PATH=h,e.JsonCreatorPlugin=r,e.JsonForm=function(e){var t=e.data,n=e.render,r=a(t,function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}(e,["data","render"])),o=r[0];return n({form:r[1],data:o})},e.useGlobalJsonForm=function(e,t){void 0===t&&(t={});var n=a(e,t),r=n[0],o=n[1];return c.usePlugins(f.useMemo(function(){if(o)return new c.GlobalFormPlugin(o,null)},[o])),[r,o]},e.useJsonForm=a,e.useLocalJsonForm=function(e,t){void 0===t&&(t={});var n=a(e,t),r=n[0],o=n[1];return c.usePlugins(o),[r,o]},Object.defineProperty(e,"__esModule",{value:!0})});
