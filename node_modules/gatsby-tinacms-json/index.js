!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("tinacms"),require("react")):"function"==typeof define&&define.amd?define(["exports","tinacms","react"],t):t((e=e||self)["gatsby-tinacms-json"]={},e.tinacms,e.React)}(this,function(e,h,d){"use strict";var m=function(){return(m=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function i(n,o){var r,i,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(a=2&t[0]?i.return:t[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,t[1])).done)return a;switch(i=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=o.call(n,s)}catch(e){t=[6,e],i=0}finally{r=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function a(n,e){if(void 0===e&&(e={}),!n||"production"===process.env.NODE_ENV)return[n,null];!function(e){if(void 0===e.fileRelativePath)throw new Error(p);if(void 0===e.rawJson)throw new Error(b)}(n);var r=h.useCMS(),t=e.label||n.fileRelativePath,o=n.fileRelativePath,i=d.useMemo(function(){return{jsonNode:n,rawJson:JSON.parse(n.rawJson)}},[n]),a=d.useState(),s=a[0],u=a[1];d.useEffect(function(){r.api.git.show(o).then(function(e){var t=JSON.parse(e.content);u({jsonNode:n,rawJson:t})}).catch(function(e){console.log("FAILED",e)})},[o]);var l=e.fields||function(e){return Object.keys(e).map(function(e){return{component:"text",name:"rawJson."+e}})}(i.rawJson);l.push({name:"jsonNode",component:null});var c=h.useForm(m({id:o,label:t,initialValues:s,fields:l,onSubmit:function(e){return r.api.git.onSubmit({files:[e.jsonNode.fileRelativePath],message:e.__commit_message||"Tina commit",name:e.__commit_name,email:e.__commit_email})},reset:function(){return r.api.git.reset({files:[o]})}},e),{values:i,label:t,fields:l})[1],f=d.useCallback(function(e){var t=e.values,n=t.rawJson,o=t.jsonNode;r.api.git.onChange({fileRelativePath:o.fileRelativePath,content:JSON.stringify(n,null,2)})},[]);return h.useWatchFormValues(c,f),[n,c]}var p="useJsonForm(jsonNode) Required attribute `fileRelativePath` was not found on the `jsonNode`.\n\n1. Check if the `gatsby-tinacms-json` was added to the `gatsby-config.js`.\n2. Check if the `fileRelativePath` attribute is included in the GraphQL query.\n\n  ",b="useJsonForm(jsonNode) Required attribute `rawJson` was not found on the `jsonNode`.\n\n1. Check if the `gatsby-tinacms-json` was added to the `gatsby-config.js`.\n2. Check if the `rawJson` attribute is included in the GraphQL query.\n",t="createJsonButton must be given `filename(form): string`",n="createJsonButton must be given `fields: Field[]` with at least 1 item",o=(r.prototype.onSubmit=function(o,r){return function(i,a,s,u){return new(s=s||Promise)(function(e,t){function n(e){try{r(u.next(e))}catch(e){t(e)}}function o(e){try{r(u.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,o)}r((u=u.apply(i,a||[])).next())})}(this,void 0,void 0,function(){var t,n;return i(this,function(e){switch(e.label){case 0:return[4,this.filename(o)];case 1:return t=e.sent(),[4,this.data(o)];case 2:return n=e.sent(),r.api.git.onChange({fileRelativePath:t,content:JSON.stringify(n,null,2)}),[2]}})})},r);function r(e){if(this.__type="content-creator",!e.filename)throw console.error(t),new Error(t);if(!e.fields||0===e.fields.length)throw console.error(n),new Error(n);this.name=e.label,this.fields=e.fields,this.filename=e.filename,this.data=e.data||function(){return{}}}e.ERROR_MISSING_RAW_JSON=b,e.ERROR_MISSING_REMARK_PATH=p,e.JsonCreatorPlugin=o,e.JsonForm=function(e){var t=e.data,n=e.render,o=a(t,function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n}(e,["data","render"])),r=o[0];return n({form:o[1],data:r})},e.useGlobalJsonForm=function(e,t){void 0===t&&(t={});var n=a(e,t),o=n[0],r=n[1];return h.usePlugins(d.useMemo(function(){if(r)return new h.GlobalFormPlugin(r,null)},[r])),[o,r]},e.useJsonForm=a,e.useLocalJsonForm=function(e,t){void 0===t&&(t={});var n=a(e,t),o=n[0],r=n[1];return h.usePlugins(r),[o,r]},Object.defineProperty(e,"__esModule",{value:!0})});
