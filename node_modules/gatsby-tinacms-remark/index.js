!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("tinacms"),require("react"),require("js-yaml"),require("@tinacms/form-builder")):"function"==typeof define&&define.amd?define(["exports","tinacms","react","js-yaml","@tinacms/form-builder"],r):r((e=e||self)["gatsby-tinacms-remark"]={},e.tinacms,e.React,e.yaml,e.formBuilder)}(this,function(e,h,p,r,i){"use strict";var w=function(){return(w=Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++)for(var a in r=arguments[n])Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);return e}).apply(this,arguments)};function u(o,i,u,l){return new(u=u||Promise)(function(e,r){function n(e){try{a(l.next(e))}catch(e){r(e)}}function t(e){try{a(l.throw(e))}catch(e){r(e)}}function a(r){r.done?e(r.value):new u(function(e){e(r.value)}).then(n,t)}a((l=l.apply(o,i||[])).next())})}function l(n,t){var a,o,i,e,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function r(r){return function(e){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;u;)try{if(a=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return u.label++,{value:r[1],done:!1};case 5:u.label++,o=r[1],r=[0];continue;case 7:r=u.ops.pop(),u.trys.pop();continue;default:if(!(i=0<(i=u.trys).length&&i[i.length-1])&&(6===r[0]||2===r[0])){u=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){u.label=r[1];break}if(6===r[0]&&u.label<i[1]){u.label=i[1],i=r;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(r);break}i[2]&&u.ops.pop(),u.trys.pop();continue}r=t.call(n,u)}catch(e){r=[6,e],o=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,e])}}}var k="useRemarkForm(markdownRemark) Required attribute `fileRelativePath` was not found on `markdownRemark` node.\n\n1. Check if the `...TinaRemark` fragment is included in the markdownRemark GraphQL query. For example:\n\nexport const pageQuery = graphql`\n  query BlogPostBySlug($slug: String!) {\n    markdownRemark(fields: { slug: { eq: $slug } }) {\n      ...TinaRemark\n      // etc...\n    }\n }\n`\n  ",y="useRemarkForm(markdownRemark) Required attribute `rawMarkdownBody` was not found on `markdownRemark` node.\n\n1. Check if the `...TinaRemark` fragment is included in the markdownRemark GraphQL query. For example:\n\nexport const pageQuery = graphql`\n  query BlogPostBySlug($slug: String!) {\n    markdownRemark(fields: { slug: { eq: $slug } }) {\n      ...TinaRemark\n      // etc...\n    }\n }\n`\n  ",g="useRemarkForm(markdownRemark) Required attribute `rawFrontmatter` was not found on `markdownRemark` node.\n\n1. Check if the `...TinaRemark` fragment is included in the markdownRemark GraphQL query. For example:\n\nexport const pageQuery = graphql`\n  query BlogPostBySlug($slug: String!) {\n    markdownRemark(fields: { slug: { eq: $slug } }) {\n      rawFrontmatter\n      // etc...\n    }\n }\n`\n  ";function v(e){return"---\n"+r.dump(e.rawFrontmatter)+"---\n"+(e.rawMarkdownBody||"")}function R(e){return function(){for(var e=0,r=0,n=arguments.length;r<n;r++)e+=arguments[r].length;var t=Array(e),a=0;for(r=0;r<n;r++)for(var o=arguments[r],i=0,u=o.length;i<u;i++,a++)t[a]=o[i];return t}(Object.keys(e.rawFrontmatter).map(function(e){return{component:"text",name:"rawFrontmatter."+e}}),[{component:"markdown",name:"rawMarkdownBody"}])}var b=require("gray-matter");function o(e,r){void 0===r&&(r={});var n=function(e){var r=p.useState(e),n=r[0],t=r[1];return p.useEffect(function(){t(e||n)},[e]),n}(e);if(!n||"production"===process.env.NODE_ENV)return[n,null];!function(e){if(void 0===e.fileRelativePath)throw new Error(k);if(void 0===e.rawFrontmatter)throw new Error(g);if(void 0===e.rawMarkdownBody)throw new Error(y)}(n);var t=h.useCMS(),a=r.label||n.frontmatter.title,o=n.fileRelativePath,i=r.actions,u=p.useMemo(function(){return{fileRelativePath:n.fileRelativePath,frontmatter:n.frontmatter,rawMarkdownBody:n.rawMarkdownBody,rawFrontmatter:JSON.parse(n.rawFrontmatter)}},[n.rawFrontmatter,n.rawMarkdownBody]),l=p.useState(),m=l[0],s=l[1];p.useEffect(function(){t.api.git.show(o).then(function(e){var r=b(e.content),n=r.content,t=r.data;s(w(w({},u),{rawFrontmatter:t,rawMarkdownBody:n}))}).catch(function(e){console.log("FAILED",e)})},[o]);var c=p.useMemo(function(){var e=r.fields||R(u);return e=e.map(function(e){return"frontmatter"===e.name||e.name.startsWith("frontmatter.")?w(w({},e),{name:e.name.replace("frontmatter","rawFrontmatter")}):e})},[r.fields]),f=h.useForm({label:a,id:o,initialValues:m,fields:c,onSubmit:function(e){return t.api.git.onSubmit({files:[e.fileRelativePath],message:e.__commit_message||"Tina commit",name:e.__commit_name,email:e.__commit_email})},reset:function(){return t.api.git.reset({files:[o]})},actions:i},{label:a,fields:c,values:u})[1],d=p.useCallback(function(e){t.api.git.onChange({fileRelativePath:e.values.fileRelativePath,content:v(e.values)})},[]);return h.useWatchFormValues(f,d),[n,f]}function m(e,r){void 0===r&&(r={});var n=o(e,r),t=n[0],a=n[1];return h.usePlugins(a),[t,a]}function a(e,r){void 0===r&&(r={});var n=o(e,r),t=n[0],a=n[1];return h.usePlugins(p.useMemo(function(){if(a)return new h.GlobalFormPlugin(a,null)},[a])),[t,a]}function s(e,r){void 0===r&&(r="markdownRemark");var n=e[r];if(!n)throw function(e){return"useRemarkForm(markdownRemark) '"+e+"' was not found on the top node of the graphql query\n\n1. Check if the '"+e+"' attribute is included in the GraphQL query. For example:\n\nexport const pageQuery = graphql`\n  query BlogPostBySlug($slug: String!) {\n    markdownRemark(fields: { slug: { eq: $slug } }) {\n      ...TinaRemark\n      // etc...\n    }\n }\n\n2. If you are using an alias, For example:\n\n   export const pageQuery = graphql`\n     query BlogPostBySlug($slug: String!) {\n       "+e+": markdownRemark(fields: { slug: { eq: $slug } }) {\n          ...TinaRemark\n       // etc...\n       }\n    }\n\n  then you can optionally use the 'queryName' option to specify a new property in place of 'markdownRemark':\n\n    export const remarkForm(BlogPostTemplate, { queryName: "+e+" })\n`\n  "}(r);return n}var n="createRemarkButton must be given `filename(form): string`",t="createRemarkButton must be given `fields: Field[]` with at least 1 item";var c=(f.prototype.onSubmit=function(a,o){return u(this,void 0,void 0,function(){var r,n,t;return l(this,function(e){switch(e.label){case 0:return[4,this.filename(a)];case 1:return r=e.sent(),[4,this.frontmatter(a)];case 2:return n=e.sent(),[4,this.body(a)];case 3:return t=e.sent(),o.api.git.onChange({fileRelativePath:r,content:v({fileRelativePath:r,rawFrontmatter:n,rawMarkdownBody:t})}),[2]}})})},f);function f(e){if(this.__type="content-creator",!e.filename)throw console.error(n),new Error(n);if(!e.fields||0===e.fields.length)throw console.error(t),new Error(t);this.name=e.label,this.fields=e.fields,this.filename=e.filename,this.frontmatter=e.frontmatter||function(){return{}},this.body=e.body||function(){return""}}e.DeleteAction=function(e){var r=this,n=e.form,t=h.useCMS();return p.createElement(h.ActionButton,{onClick:function(){return u(r,void 0,void 0,function(){return l(this,function(e){switch(e.label){case 0:return confirm("Are you sure you want to delete "+n.values.fileRelativePath+"?")?[4,t.api.git.onDelete({relPath:n.values.fileRelativePath})]:[2];case 1:return e.sent(),window.history.back(),[2]}})})}},"Delete")},e.RemarkCreatorPlugin=c,e.RemarkForm=function(e){var r=e.remark,n=e.render,t=m(r,function(e,r){var n={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.indexOf(t)<0&&(n[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(t=Object.getOwnPropertySymbols(e);a<t.length;a++)r.indexOf(t[a])<0&&Object.prototype.propertyIsEnumerable.call(e,t[a])&&(n[t[a]]=e[t[a]])}return n}(e,["remark","render"])),a=t[0];return n({form:t[1],markdownRemark:a})},e.createRemarkButton=function(e){return new c(e)},e.globalRemarkForm=function(n,t){return void 0===t&&(t={}),function(e){var r=a(s(e.data,t.queryName),t)[0];return p.createElement(n,w({},e,{data:w(w({},e.data),{markdownRemark:r})}))}},e.liveRemarkForm=function(a,o){return void 0===o&&(o={}),function(r){var e=m(s(r.data,o.queryName),o),n=e[0],t=e[1];return p.createElement(i.TinaForm,{form:t},function(e){return p.createElement(a,w({},r,{data:w(w({},r.data),{markdownRemark:n})},e,{form:t}))})}},e.remarkForm=function(n,t){return void 0===t&&(t={}),function(e){var r=m(s(e.data,t.queryName),t)[0];return p.createElement(n,w({},e,{data:w(w({},e.data),{markdownRemark:r})}))}},e.useGlobalRemarkForm=a,e.useLocalRemarkForm=m,e.useRemarkForm=o,Object.defineProperty(e,"__esModule",{value:!0})});
